读书笔记 2018-10-06
=====================================

.. toctree::
   :maxdepth: 1

时间：10月08日

书籍：《精通Hadoop》

进度：201页 - 234页

----------

Hadoop安全
^^^^^^^^^^^^^^^^^^^^^
- **数据安全** 有四大核心功能分别是： **认证** 、 **授权** 、 **审计** 和 **数据保护** 。
- Hadoop中的认证主要有两种： **简单认证** 和 **伪认证** 。
- Hadoop支持无缝地集成很多像 **LDAP** 和 **活动目录** （active directory）这样的用户存储。在这些存储的帮助之下，可以将 **Kerberos** 实现成一个认证机制。
- 对于HDFS， Hadoop提供了“文件级”的细粒度访问控制。这种访问控制非常类似于那些基于UNIX的文件系统。MapReduce计算层在资源级别同样有访问控制列表（Access Control List， ACL）。Hadoop服务允许有他们自己的授权功能。例如，可以使用粗粒度的访问控制机制来保护Hive的表，如SQL。
- 所有的访问和操作都需要被记录在审计日志中，以便在稍后的时间点进行审计。
- Hadoop与 **Kerberos** 认证结合时，最好是将这个密码写入一个叫keytab的文件。使用 ``ktutil`` 命令来创建 **keytab文件** 。然后使用 ``-t`` 参数在 ``kinit`` 命令中指定这个 **keytab文件** 。 ``klist`` 命令可以显示一个用户拥有的不同票据。 ``kdestroy`` 命令可以注销那些不再使用的票据。
- 默认情况下， Hadoop集群所有的HTTP网络端口都没有启用认证。这意味着任何人只要知道网页地址就可以在集群中访问这些不同的服务。不过可以通过配置HTTP网络接口，明确要求Kerberos认证使用HTTP SPNEGO协议。这种协议可以很好地支持所有主流的浏览器。具体配置情况 `204页` 。
- HDFS的授权中文件之后两种权限“读”和“写”；文件夹还有一个“x”权限，表示可以“读”其子目录。
- HDFS的授权针对目录：读权限允许用户或是属于某个组的用户列出目录中的内容。写权限允许用户或组可以在该目录中创建文件和子目录，或是追加该目录中文件内容。目录还有一个特殊的执行权限x，允许用户或组可以访问该目录的子目录。
- HDFS文件没有POSIX中的setuid和setgid的概念。
- HDFS的目录允许设置粘滞位。
- 当一个进程在HDFS上创建一个文件或目录时，它自动将所有者设为该进程的所有者。不过，组继承自父目录的组，也就是说跟父目录的组一样。
- Hadoop内置有一个通过连接LDAP数据存储来确定组的映射服务。
- NameNode负责调用相应的API来确定指定用户的组列表，然后将结果提供给DataNode。此外，当与基于UNIX的系统做比较时，所有的组和用户名都是被存为字符串，而不是数字。
- 严格地说，只有文件或目录的所有者或超级用户（superuser）才可以修改模式。
- 在Hadoop中，启动NameNode的用户被称为HDFS的超级用户。超级用户拥有HDFS中最高的权限。对于超级用户的权限检查是不会失败的，而且超级用户的身份允许执行所有操作。
- 超级用户的身份并不是永恒的。它严格地取决于“谁来启动NameNode服务”。
- 管理员可能也需要指定一组用户具备超级用户的身份，不过这些用户并不会去运行 **NameNode** 。将 ``dfs.permissions.superusergroup`` 属性的值设置为需要执行超级用户权限的一组用户。
- HDFS提供了一个Web界面来访问文件系统。 Web服务器以某种身份运行这个界面，而这个身份由dfs.web.ugi配置属性指定。属性值由运行这个Web界面的用户和组的列表所组成，以逗号分隔。这个属性值中的用户也可以指定为超级用户。如果Web服务器以超级用户的权限运行，那就可以查看整个命名空间。如果设置为超级用户以外的用户和组，那就只能基于这个用户或组的权限访问有限的内容。另外，在逗号分隔的列表中，可以指定多个组。 
- HDFS提供了配额（quota）用于限制使用。配额可以限制文件数及使用的空间量。这些配置可以设置在一个目录级别，然后对所有子文件和子目录都起作用。文件的备份会被计算在配额内。
- Hadoop中存在服务级授权。细节请看 `210页` 。
- 为了“Hadoop 中的数据保密性”，我们可以在 **MapReduce** 的洗牌阶段对传输的数据进行加密。详见 `211页` 。例外需要配置 **密钥库** 和 **信任库** ，见 `213页` 。
- Hadoop 中的日志审计通过 **log4j** 实现，使用 ``log4j.properties`` 文件来配置日志。 ``log4j.properties`` 文件将日志打印的阈值设为WARN。通过将这个等级设为INFO，可以开启日志审计。详见 `216页` 。

使用Hadoop进行数据分析
^^^^^^^^^^^^^^^^^^^^^^^^
详见 **第12章** `218页`

- 当数据集的容量等于或大于1 TB时，推荐使用Hadoop。
- 当数据集较小，并且传统的SQL由于其分析特性而变得无用武之地时，使用Hadoop并且直接与文件系统交互是很明智的做法。
- 本章通过 ``Tf-idf`` ，介绍了“使用 Hadoop 和 Mahout 进行文档分析”。

名词摘录
^^^^^^^^^^^^^^^^^^^^^

Kerberos
  一种“安全体系”。它分为是三个步骤：验证身份、获取“票据”、进行通信。相关服务器：认证服务器（ **AS** ）、票据授予服务器（ **TGS** ）、服务器。

粘滞位
  又称粘着位，是Unix文件系统权限的一个旗标。最常见的用法在目录上设置粘滞位，也只能针对⽬录设置，对于⽂件⽆效。则设置了粘滞位后，只有目录内文件的所有者或者root才可以删除或移动该文件。如果不为目录设置粘滞位，任何具有该目录写和执行权限的用户都可以删除和移动其中的文件。实际应用中，粘滞位一般用于/tmp目录，以防止普通用户删除或移动其他用户的文件。

拒绝服务攻击
  简称 ``DoS`` ，是攻击者想办法让目标机器停止提供服务，是黑客常用的攻击手段之一。

  其实对网络带宽进行的消耗性攻击只是拒绝服务攻击的一小部分，只要能够对目标造成麻烦，使某些服务被暂停甚至主机死机，都属于拒绝服务攻击。拒绝服务攻击问题也一直得不到合理的解决，究其原因是因为网络协议本身的安全缺陷，从而拒绝服务攻击也成为了攻击者的终极手法。

  攻击者进行拒绝服务攻击，实际上让服务器实现两种效果：一是迫使服务器的缓冲区满，不接收新的请求；二是使用IP欺骗，迫使服务器把非法用户的连接复位，影响合法用户的连接。
