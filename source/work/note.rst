工作感悟
============================

.. toctree::
   :maxdepth: 4

这里记录一些工作的感悟

- etl去重和去重模块需要加一个判断：是否需要更新数据&通知拉取。如果一条广告一天内抓取多次的话，就不触发update和拉取。

  - 有数据更新信息的可能”，这个需要根据上次抓取的内容，和当时抓取的内容判断。减少不必要的更新和拉取。

- 语言探测（实际上是受众分析的一个这种方案）、广告主分析（目前主要是分类）、数据拉取同步，这三者，在新架构中是什么关系 ？

  - 我觉得广告主分析和语言探测应该某种意义上旁路，和拉取不一样，拉取在主干上。语言探测、广告主分析等功能模块按照某个机制和拉取交互。
  - 可是如果没有广告主的话，拉取是无法进行的。——徐进
  - 嗯，之前讨论过得点是：当该条没有语言探测拉不拉取? ——李勇
  - 那石头哥说的对，广告主分类信息和语言探测都应该算是非必要信息。这两个模块作为旁路，唯一的代价就是增加队列使用。
  - 刚才和闫东讨论，语言探测，如果不作为主干流程的话，去重这块得做好判断，广告是否需要进行语言探测。语言探测对creatvie进行探测。插入和文案更新需要探测。

感悟
^^^^^^^^^^^^^
- 工作中的成就感来自与两个方面，“完美kill掉众多case”和“技术上有所提升”。可惜去年我都没有做到。我在考虑今年将手上负责的模块减少在2个以下，让自己将手上的模块正好，而不是一直忙于在各个模块之间修Bug。
- 我的开源经历就从翻译开始吧！
- 今天，石头哥有强调查看产品了。可是最近我都忙的脚不沾地，如果有时间静下心来给产品挑毛病？
- 石头哥现在正在寻找电商的常用关键词列表。
- 昨天晚上走的时候，我说了一句：“徐进，似乎你接手UI之后，就很少9点半之前走了。”这句话似乎不应该说。
- 周一，石头哥问我“葡萄味道怎么样？”，我应该顺着回答“很好吃”，而不是给出出人意料的答案“因为懒，早晨没有下地”。
- ES接口推出之后，对于准备向曲雪介绍这个接口。不过曲雪拒绝了，她只希望我提供使用此接口的例子。

  - 我：我的初衷是让曲雪了解ES相关的代码逻辑，更深入的了解这个方法。
  - 他：这个方法对我来说只是一个工具，我不需要了解它的内部实现，同时我手上也有很多工作，如果通过阅读code来知道这个方法的用法，周期太长了，我的时间不够。

- 石头哥对于新接口的参数使用缩写aggs有疑虑，要我改为全拼：aggregations。

  - 我：ES是我的地盘，除了公司代码公约之外的其他Code方面的决策，应该是我排版。即便是我的领导也没有道理进行插手。
  - 他：对外提供的接口，应该友好易懂。这不只是ES项目内部的事情。

- 因为我的发展方向是技术，所以对于“别人对我产出”的意见十分在意，同时，对于code的自主性也很在意。
- 一个项目交给我，那么这里就是我的地盘。出了问题找我，而内部的事情，请不要随意发表决定。
- 监控报表页面的项目推荐，如果在半年前进行强行推进的话，是否就已经成功了？但是当时的环境合适强行推进吗？
- 今天跨部门开会，叫了徐进，没有叫我，像这样的事情总会让我感觉焦虑。特别是我与徐进正在看似平级的时候。
- 今天准备推行update_status的改动，这是一个比较小的事情，但是我把它扩大了。导致差点陷入无休无止的讨论中。我得到的教训就是：

  - 如果你认为事情不是很重要，就默默的推进就好。不要将这件事情抛给太多人，“浪费”大家的时间。
  - 公司架构过程过程中，应该对员工有一个技术评级。对于小范围的变动，具有一定级别的人可以自己决定如何处理。
  - 今天抛出的问题，刚一开始就被传坚带偏了。这说明我对这样场景的把控能力还是不足。

- 今天准备推动“拉取”模块的优化。发现我对拉取模块的上游都不清晰。我甚至不知道etl模块在什么情况下才会发送“拉取”请求。我都不知道，大部分渠道，在更新时，只修改update_status而不发送队列！
- 今天徐进给了我一个任务：通过ES，输入geo，获取相关的广告主。实际上我是可以拒绝的，因为现在已经有了通过geo获取创意ID，其他人员，可以通过现有接口找到广告主。
- 对于EsBehavoir这样的共用接口，返回结果中，提供一个是否过时的警告。
- 在设计新架构之前，应该先清楚老架构问题出在哪里？比如说：代码抽象不够，导致新功能上线麻烦；运行效率不高，但是那一部分导致运行效率不高？
- 工作任务排期最大的粒度也要压制在“周”级别，这样才能高效、有效。
- etl模块重构过程是一个很好的了解socialpeta整体结构的机会，但是我因为个人情绪而放弃了这样一个好的机会！我原来是经不起失败和否定的！
- 今天和传坚吵了一架，“收获”颇丰。

  - 我和传坚和解时，不应该与其谈论“排斥跨模块的改动的上线”。

- 最近情绪很低落，昨天还和传坚吵了一架，但是谁知道在和石头哥沟通的时候，会因为石头哥的一个“OK”的表情包而心情转好！
- 徐进（公司）的态度：在年前，对于新架构上线的重视程度要高于“大客户”的需求。或者说，徐进愿意假期完成这个功能。

经验总结
^^^^^^^^^^^^^^^^^
- 切换队列时，应该将数据发送到队列之后的update_status，设为1，而不是0。

  - 原因：实际操作过程中，可能有部分渠道的抓取没有切换到队列，这部分数据在数据库中办法识别，导致数据修复很麻烦。

- 对于一系列队列，有时候可以考虑有一个进程准备控制对这一系列队列的send message操作。具体场景：

  - 因为抓取模块对于同一创意，更新的速度非常的快。太过即时的数据流会导致队列无谓的消耗。如果不是由抓取模块发送拉取message，而是有其他进程，4-5个小时遍历一次creative_all中update_statue = 1的数据，在扔队列，这样会节省大部分队列的消耗，同时也节省了队列下游的资源消耗。另一种解决方案是，独立进程监控creative_all表，updated_at在距离当前时间超过4-5个小时的，仍如队列。等等。

- 拉取模块和建索引模块不全面，导致年终计算一些创意指标的时候没有相关的数据准备。
- 拉取进程，对于任务量不紧张的进程，可以降低他们的启动频率，这样可以有效的减低数据库的连接数。
- ES做索引，每3分钟启动一次进程，每个进程读10个队列消息，每个消息分配一段ID域。但是如果这个进程所以接受的消息的ID域内都没有要做索引的数据的话，就会导致这个进程在几秒内退出，大大影响了效率。所以进程推出的条件中，应该加入“最低做索引的（有效的）数据量不能低于某个值（比如1万）。
- 传坚拆分AN表的时候，我应该争取一下，让其将老数据迁移到新表的。导致现在我的新拉取流程编写起来很麻烦，很被动。

求职标准
^^^^^^^^^^^^^
1.  领导是愿意授权的，而不是事无具细的。
#.  公司有很好的上升空间。

工作备忘
^^^^^^^^^^^^^
- `Vuggle` , `Applovin` 渠道，似乎是能够抓取到geo信息，并且存在target.geo中。
- 创意详情中，如果title太长，会被挤下去。
- 今日头条，手机百度，内涵段子：文章内的广告比较多。
- 在抓取创意过程中，我们一般有限覆盖这些国家： `CN, US, P, BR, IN, ID, RU, MX, DE, AE, KR, SA, EG, AR` 。

机器
#############
- ``us.socialpeta03`` 索引 ``47.88.27.99``
- ``us.socialpeta01`` 拉取 ``47.88.4.200``
- ``bj.appsmoto.frontend01`` 机器 ``182.92.196.218``
- ``bj.socialpta04`` 北京索引 ``59.110.15.73`` ``10.26.101.117``

人员分配
#############
- 李勇：去重
- 雪城: `AN` , 国内渠道, `adbug`, 文章类创意。
- 钱立: `Vuggle` , `Applovin` 渠道抓取
- 李赞: `Twitter`

面试注意
^^^^^^^^^^^^^
1.  面试官诱导两句，你就可能开始diss老东家或老上司了。

经历
^^^^^^^^^^^^^
- 2016-07-01：负责youtube抓取
- 2017-01-01：切换到产品UI
- 2017-10-01：切换到ES支持
- 2017-11-01：兼顾拉取模块
- 2017-12-01：抓取量到达百万级别之后，现有框架不足以支撑。需要优化。参与其中

未处理的内容
^^^^^^^^^^^^^^^^^^^^^^
1.  无埋点的“用户操作收集功能”对于重交互的产品是一个不错的思路。比如说智线的视频产品。
#.  实际工作过程中，应该避免“不同部门间的沟通成本”，但同时智线在新功能的设计过程中，提倡每个人都参与到审核过程中来。这其中的取舍就是一门技术了。
#.  但无论如何，都应该减少“不同部门”间重复、低价值的劳动。
#.  产品设计，不仅是满足眼前用户的功能需求，还要满足整个产品运营体系的增长需求。
#.  京东经常会推荐一些我刚买过的产品。但实际上，通过我的操作记录可以发现：我只是一个普通用户，刚买过的产品，短期内我是不会在购买的了。针对我这样的客户，它还不如推荐一些我没有买过的但最近比较火爆的类型商品呢。同时它也可以将我归类：学生、白领、宅男等类型，针对性的推荐一些商品。或者根据我的购买记录，推荐一些周边的商品，比如我刚买了一个机械键盘，为我推荐耳机、音箱、主机、电脑包；我买了一个自行车，为我推荐车锁、里程表等骑车用品。并根据我的消费水平，推荐不同档次的东西。根据用户的消费水平、性格，推荐节假日的礼品。
#.  对于socailpeta产品，用户更多用的“可能”是最近看见的筛选而非综合排序。因为我的的转化是预估的。那么换一个角度，我们是否可以通过用户的点击操作找出高质量的创意呢？再将“创意质量”这一因素增加到“转化计算公式”中。

    -   如此的话，问题就来了。如要统计“当前用户数量”、“当前活跃用户数量”、“活跃用户平均每天的点击量”。
    -   如何加大用户的产品的“粘着度”，提高用户有价值点击量？

#.  做一个相关的互联网产品：有趣的广告创意。

.. 你看不到我，看不到我！
