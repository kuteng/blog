工作日记
============================

.. toctree::
   :maxdepth: 2

本周任务
^^^^^^^^^^^^
2018-03-16

1. 出北京节点的文档。

2018-03-16

1. 主要讨论数据架构
#. 北京节点延误

2018-03-19

今天除了第一条，其他条目为后来补充的。怀疑工作尽力与拉取相关，部分时间与良庆/徐进讨论拉取模块。
1. 上午：完成周报。
#. "https://thegadgetsnob.com”在 ``searchAllCreativesByAes`` 和 ``searchCreativesByAes`` 上搜索结果不一致 —— 找原因。 —— 没有全文搜索。
#. 北京节点工作，ES curl需要带密码。

2018-03-20

1. 讨论数据架构，占用较多时间。北京节点延误。
2. 北京节点通过Curl，无法向ES发送请求。

   - 上线临时解决方法
   - 找到问题所在。

2018-03-21

1. 搜索广告搜索失败的Bug。
#. 与良庆讨论biz的新设计。
#. “朕的天下”搜索结果中，有一个广告没有出来。
#. 语言探测不准的原因。
#. `北京节点` 延误

2018-03-22

今天无人打扰，北京节点搭建速度飞快。从创建索引（有昨天的基础）到数据导入，再到EsBehavior改写，在到数据验证（为完成）。

2018-03-23

- 讨论数据架构（去重逻辑、新数据创建流程、老的“无根”数据的处理方式）。——2个小时（上午）

  - 如果我要从头阅读聊天记录的话，估计还要一个小时。

- 下午时间全部用于新机器的环境搭建，晚上也是如此。

工作备忘（临时）
^^^^^^^^^^^^^^^^^
1.  删除了创意索引中的字段：publisherName。
2.  [优化] 创意索引中，title, title2 的格式都不合适，需要统一成title3。
3.  [优化] 创意索引中，storeId, storeId2需要统一一下。此外appName、appName2也是一样。
4.  [优化][UI] UI项目引用common项目的config/web.php，而不是api项目的config/web.php。因为许多共用的配置都配置在common，如果ui想引用，必须使用绝对路径。如下： ::

        'appPlatform' => require(__DIR__.'/../../common/config/params/appPlatform.php'),
        'langToGeo' => require(__DIR__.'/../../common/config/params/lang-to-country/langToCountry.php'),
        'creative'    => require(__DIR__.'/../../common/config/params/creative.php'),
        'data' => require(__DIR__.'/../../common/config/params/data.php'),
        'geoRelations'  => require(__DIR__.'/../../common/config/params/relations/geo.php'),
        'geoNames' => require(__DIR__.'/../../common/config/params/code-to-en/geo.php'),
        'catetoryRelations' => require(__DIR__.'/../../common/config/params/relations/category.php'),
        'categoryNames' => require(__DIR__.'/../../common/config/params/code-to-en/category.php'),
        'dataNames' => require(__DIR__.'/../../common/config/params/code-to-en/data.php'),
        'selectNames' => require(__DIR__.'/../../common/config/params/code-to-en/select.php'),
        'searchConfig' => require(__DIR__.'/../../common/config/params/search.php'),
        'es' => require(__DIR__.'/../../common/config/params/es.php'),

5.  [优化] UI部分的缓存可配置，在配置文件中或用户设置设置中（url参数的配置不提倡）。因为这个缓存对于ES调试造成了困扰。
6.  [优化] ES搜索中，即便是按照“最后看见排序”，也需要设置一个相关度的阀值，比如说 ``> 10`` 。具体Case如下，图二中，因为“卖家”字段能够匹配上“SuperB Cleaner”，所以生效。
    |es-case-01-a|
    |es-case-01-b|
7.  [任务] 关注一下各渠道etl的不同，特别是target等字段。实例：最近发现Vungle渠道大部分数据的title/body为空，也就是说语言探测对其无用，但是他的抓取逻辑可以获取一些“语言信息”，而这些东西没有保存下来，也没有拉取到biz。

工作之问
^^^^^^^^^^^^^^^^^
- ES做索引是在哪个Mysql库读数据的？
- is_show是去重模块维护吗？

其他记录
^^^^^^^^^^^^^

这里记录一些工作日记，这些抱怨应该展现出来吗？

- 今天与石头哥争论，后来徐进也参与进来了。突然发现似乎每次我与石头哥进行出现分歧，徐进都是支持石头哥的。这种情况我需要引以为戒，是组织中我与徐进是打配合的，而石头哥是我们的领导。徐进在这一点的上表现，实际上让我心里有些难以接受，虽然我能够进行自我调节。其实徐进的人品我是相信的，他参与讨论必然有其“观点”，而不是出于某些不和谐的动机。我想出现这种现象的愿意有一下几点：

  * 我的坚持是大部分都是不对的，当然难以得到别人的认同。
  * 他在认同时石头哥时是站出来的；在不支持石头哥而又不涉及自己的模块的时候，认为参与进来于我没有太大帮助，也就不参与了（这样向来确实有几次讨论因为涉及我们两个模块，所以我们在观点一直，并与石头哥讨论）。

    - 今天与石头哥对于ES的讨论，徐进虽然对于ES不熟悉，不过依据其他模块的经验，然为石头哥是对的，所以也参与到了讨论中。

- 就今天与石头哥的争论，我刚刚关注的是争论的成败。而实际上，争论本身的内容才是我更应该去关注的东西。

  * 石头哥认为开发机访问ES，有安全隐患。
  * 我认为开发机访问ES，可以提高开发效率。安全隐患就现在公司规模可以暂时忽略。

----

在数学上，我们构建一个系统是，最关注的是这样几点：

1. 这个系统的对象要通过运算产生新的对象。
#. 如果原始对象具有某些特性，在运算之后的对应应该尽可能保留这些特性，这叫做closed。
#. 可用的运算越多越好。

----

梓洲对于每次对于一个返回结果有疑惑的话，都会找我，很麻烦！——我想改变ES对于业务段黑盒这种状态。例子：::

    方法：aggsCreativeCountAtAdvertiserInWeekFilterChannelApptype
    参数：{"begin":1513353600,"end":1521129600,"apptype":[1],"advertiser_type":1,"channel":[9]}
    结果：{"total": 0, "aggs": []}

问题：梓洲对于这个返回结果为空的状态存在疑惑。其实测试方式很简单，去掉分析语法，测试这些筛选条件下是否有广告，然后在测试去掉“channel = 9”这个筛选条件后，是否有广告。就可以验证这个疑问了，可是ES对于梓洲是黑盒，所以，他必须通过我来验证这个数据是否正确。

今天 ``https://thegadgetsnob.com`` 的处理，对于现有EsBehavoir也有些不适用：
- 同时搜索 ``https`` 和 ``thegadgetsnob.com`` 。只是对其有不用的权重。
- title中搜索 ``https thegadgetsnob.com`` ，storeId中搜索 ``thegadgetsnob.com`` 。
- 如果是 ``https://www.thegadgetsnob.com`` 是否应该去掉 ``www`` ，title/body中有完整的 ``https://www.thegadgetsnob.com`` 或 完整的 ``https://thegadgetsnob.com`` 该如何处理？

----

ES设置了用户名密码，对于这一点也我是持否定态度的。

----

我争论的水平真的很差，怎么办！
    前几天，针对ES是否应该将开发机的IP加入的白名单，我与石头哥进行了争论。他提出了一个观点，这样认为任何一个人都有对ES进行毁灭性操作的可能性了。我当时无法反驳，今天才有了一些思路。首先现在ES维护人员只有我一个人，除了我公司谁还会在ES上进行操作？同时就算以后人多了，也应该是对开发机在ES上的操作进行限制，而不是直接屏蔽掉开发机的ES。
    我真的很讨厌这种组织架构。公司不大，ES只有我一个人负责，但是ES的开通、通知台、白名单确实有例外一个人进习惯负责。这样的好吗？每次这样的事情都需要讨论一边，重要的是每次我都是失败的一方，而事后我还是认为自己是对的！很痛苦。


----

2018-03-22
  今天李勇感慨，为什么我们不能关注一下群里面的消息。其实很简单，因为现在石头哥就已经对我的进度表示不满了，如果在关注群里面的消息。我的进度就更慢了。

----

2018-03-21
  今天石头哥问我EsBehavoir的代码太混乱，一直说重构，为什么半年一直没有重构。我当时心里就怒了，为什么没有重构？你将拉取模块、语言探测模块交给我，然后又抱怨我ES模块没有处理好！你说为什么，因为你不断给我插入新任务。现在好不容易将“拉取模块”交出去了，准备按部就班的处理ES模块的问题，你又不断的和我算旧帐，有意思吗？我知道你可能想让我重视这个问题，但是你知道我现在的想法吗？—— 你爱怎么说怎么说，我还是按照我的优先级处理ES的问题。

  这是教训，我需要避免。

以下是我想石头哥发的私聊——沟通
  对于EsBehavoir的问题，在优先级上，"相关性优化"、"北京节点上线"、"ES测试框架的搭建"都要比它高，所以年后到现在一直没有处理它。至于年前，“相关性优化”都没有处理好，更不要说“EsBehavoir的优化”了。这样再往深了说又是老生长谈了：拉取模块挤占了ES模块的工作时间；拉取模块一直没有处理好，因为Case频发、ES模块、语言探测模块的恶性循环。我不愤的是：现在好不容易将“拉取模块”交出去了，准备按部就班的处理ES模块的问题，你又不断的和我算旧帐！——给点时间，让我将旧帐一个个的处理完好吧！

  关于ES的问题，之前与徐进就“我是否参与到UI工作中”的沟通时已经提到了其中三点：“相关性优化”、“ES测试框架搭建”、“EsBehavoir优化”，并明说了，我后面的工作集中在这三方面以及语言探测的准确度，不想再接手UI内容了。后来又加入了北京节点上线，这些事情自然要往后挪。——你如果再追究北京节点上线时间长的问题，我就又要解释关于“数据架构的讨论”和最近的线上Case了。

  我感觉你现在的“追究”行为已经成为我工作的负担了，我现在不是在想提高效率，而是准备将每天的工作事情都记录下来——目的是之后你在“追究”的时候，我把每天都做了什么、为什么没有解决ES优化，都一一列举出来，说的你哑口无言。感觉都病态了！

----

2018-03-01
  昨天想了一下。我的努力方向不应该是攻城掠地，而应该是向下向细发展。将技术研究透彻。今天起，晚上预留时间，研究elasticsearch。

----

2018-02-27
  记得前些日子与良庆谈到徐进，当时良庆说道徐进的技术水平不高，我没有反驳。现在回想起来，未必没有“借贬低别人抬升自己”的心思——这是不应该的。我与徐进合作了这么久，不应该存在这样的想法。

  刚刚给石头哥去消息，说这次定级申请我就不提交了，因为我对过去半年的工作不满意。石头哥只会了一个“OK”，感觉有些失落。——这种情绪的产生应该是基于“我渴望被安慰”的原因吧！或者是我的内心很软弱。

----

2018-02-26
  当初职位分工的时候，我选择了技术方向而非管理方向，但是现在我有些后悔了。原本我以为管理方向与技术方向是平行的，但是在实际工作中，这两者似乎是有上下级关系的。
  - 工作分配上，任务优先集上，技术方向需要配合同级的管理方向的工作。

----

2018-02-25
  还没有开工，就遭遇的糟心事。似乎预示了不好的一年。
  我的开工时间应该是这周六，可惜我记错了，以为是下周一。
  如果我是leader，我应该怎么做呢？

  - 新的一年我希望的我的同事以一种积极愉悦的状态开工，所以我会与他私下沟通，极力缩小这件事的影响。
  - 处于小惩大戒的目的，在部门/项目群中，讨论这件事情。避免以后其他员工犯类似的错误。出现这样的问题预示这什么？
  - 我的工作状态是不正常的，连请假的截止日期都记错了。我最近都是以一种消极的态度面对工作吗？怎么会出现这种消极的态度？
  - 我需要积极的调整自己的状态。无论结果结果如何，新的一年，我都需要拿出新的姿态来开始！

----

2017-12-03
  今天有情绪失控了。是因为最近的存在感很低？

----



.. |es-case-01-a| image:: es-search-case01-a.png
.. |es-case-01-b| image:: es-search-case01-b.png
